@page "/add-activity"

<PageTitle>Add Activity</PageTitle>

<RadzenColumn SizeMD=12>
    <RadzenAlert Shade="Shade.Lighter" Variant="Variant.Flat" Size="AlertSize.Small" AlertStyle="AlertStyle.Danger" Visible="@errorVisible" AllowClose="false">@errorMessage</RadzenAlert>
    <RadzenTemplateForm TItem="ActivityRecord" Data="@activityRecord" Visible="@(activityRecord != null)" Submit="@FormSubmit">
        <RadzenRow style="margin-bottom: 0.5rem">
            <RadzenColumn>
                <RadzenLabel Text="Year" Component="Year" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenTextBox @bind-Value="@activityRecord.YearStr" Name="Year" />
                <RadzenRequiredValidator Component="Year" Text="Year is required" />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow>
            <RadzenText Text="Consumption by Kg" TextStyle="TextStyle.H6" />
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Beef" Component="Beef" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Beef" Name="Beef" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Beef" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Lamb" Component="Lamb" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Lamb" Name="Lamb" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Lamb" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Pork" Component="Pork" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Pork" Name="Pork" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Pork" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Poultry" Component="Poultry" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Poultry" Name="Poultry" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Poultry" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Coffee" Component="Coffee" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Coffee" Name="Coffee" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Coffee" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Milk" Component="Milk" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Milk" Name="Milk" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Milk" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Olive Oil" Component="OliveOil" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.OliveOil" Name="OliveOil" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="OliveOil" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Cheese" Component="Cheese" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Cheese" Name="Cheese" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Cheese" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Eggs" Component="Eggs" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Eggs" Name="Eggs" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Eggs" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Rice" Component="Rice" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Rice" Name="Rice" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Rice" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow style="margin-bottom: 0.2rem">
            <RadzenColumn>
                <RadzenLabel Text="Chocolate" Component="Chocolate" style="width: 100%" />
            </RadzenColumn>
            <RadzenColumn>
                <RadzenNumeric style="display: block; width: 100%" @bind-Value="@activityRecord.Chocolate" Name="Chocolate" ShowUpDown="false" />
                <RadzenNumericRangeValidator Component="Chocolate" Min="0" Text="Value must be positive or zero." />
            </RadzenColumn>
        </RadzenRow>


        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.End" Gap="0.2rem" style="margin-top: 1rem">
            <RadzenButton ButtonStyle="ButtonStyle.Primary" ButtonType="ButtonType.Submit" Icon="save" Text="Save" Variant="Variant.Flat" />
            <RadzenButton ButtonStyle="ButtonStyle.Light" Text="Cancel" Variant="Variant.Flat" Click="@CancelButtonClick" />
        </RadzenStack>
    </RadzenTemplateForm>
</RadzenColumn>

@code {
    [Inject]
    protected IJSRuntime JSRuntime { get; set; }

    [Inject]
    protected NavigationManager NavigationManager { get; set; }

    [Inject]
    protected DialogService DialogService { get; set; }

    [Inject]
    protected TooltipService TooltipService { get; set; }

    [Inject]
    protected ContextMenuService ContextMenuService { get; set; }

    [Inject]
    protected NotificationService NotificationService { get; set; }

    [Inject]
    public ActivitiesDBService dBService { get; set; }

    string errorMessage { get; set; }
    bool errorVisible;

    protected ActivityRecord activityRecord;

    protected override void OnInitialized()
    {
        activityRecord = new ActivityRecord();
        errorMessage = "";
    }

    protected async Task FormSubmit()
    {
        errorVisible = false;
        try
        {
            await dBService.CreateActivityRecordAsync(activityRecord);
            DialogService.Close(activityRecord);
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
            errorVisible = true;
        }
    }

    protected void CancelButtonClick(MouseEventArgs args)
    {
        DialogService.Close(null);
    }
}
